{"version":3,"sources":["../../src/middlewares/jwt.ts"],"sourcesContent":["import { Elysia, error, t } from 'elysia'\n\nimport { User } from '@/models/User'\n\nimport { jwtSettings } from '@/shared/jwt-settings'\n\nconst bearerTokenGuard = {\n  headers: t.Object({\n    authorization: t.String({\n      pattern: '^Bearer \\\\S+$'\n    })\n  })\n}\n\nexport const jwt = new Elysia()\n  .use(jwtSettings)\n  .guard(bearerTokenGuard)\n  .derive(async ({ headers: { authorization }, jwt }) => {\n    const token = authorization.slice('Bearer '.length)\n\n    const decoded = await jwt.verify(token)\n    if (!decoded) {\n      throw error('Unauthorized', 'Invalid token payload')\n    }\n\n    const user = await User.findById(decoded.id).select('-password')\n    if (!user) {\n      throw error('Unauthorized', 'User not found')\n    }\n\n    return { user }\n  })\n"],"names":["jwt","bearerTokenGuard","headers","t","Object","authorization","String","pattern","Elysia","use","jwtSettings","guard","derive","token","slice","length","decoded","verify","error","user","User","findById","id","select"],"mappings":";;;;+BAcaA;;;eAAAA;;;wBAdoB;sBAEZ;6BAEO;AAE5B,MAAMC,mBAAmB;IACvBC,SAASC,SAAC,CAACC,MAAM,CAAC;QAChBC,eAAeF,SAAC,CAACG,MAAM,CAAC;YACtBC,SAAS;QACX;IACF;AACF;AAEO,MAAMP,MAAM,IAAIQ,cAAM,GAC1BC,GAAG,CAACC,wBAAW,EACfC,KAAK,CAACV,kBACNW,MAAM,CAAC,OAAO,EAAEV,SAAS,EAAEG,aAAa,EAAE,EAAEL,GAAG,EAAE;IAChD,MAAMa,QAAQR,cAAcS,KAAK,CAAC,UAAUC,MAAM;IAElD,MAAMC,UAAU,MAAMhB,IAAIiB,MAAM,CAACJ;IACjC,IAAI,CAACG,SAAS;QACZ,MAAME,IAAAA,aAAK,EAAC,gBAAgB;IAC9B;IAEA,MAAMC,OAAO,MAAMC,UAAI,CAACC,QAAQ,CAACL,QAAQM,EAAE,EAAEC,MAAM,CAAC;IACpD,IAAI,CAACJ,MAAM;QACT,MAAMD,IAAAA,aAAK,EAAC,gBAAgB;IAC9B;IAEA,OAAO;QAAEC;IAAK;AAChB"}